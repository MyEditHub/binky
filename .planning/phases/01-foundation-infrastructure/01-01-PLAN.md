---
phase: 01-foundation-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - tsconfig.node.json
  - vite.config.ts
  - index.html
  - src/main.tsx
  - src/App.tsx
  - src/styles.css
  - src-tauri/Cargo.toml
  - src-tauri/tauri.conf.json
  - src-tauri/build.rs
  - src-tauri/src/lib.rs
  - src-tauri/src/main.rs
  - src-tauri/capabilities/default.json
  - src-tauri/Entitlements.plist
  - src-tauri/Info.plist
  - src-tauri/migrations/001_initial.sql
autonomous: true

must_haves:
  truths:
    - "Tauri v2 app compiles and launches on macOS with `npm run tauri dev`"
    - "SQLite database is created on first launch at AppData directory"
    - "macOS entitlements grant network client and file access permissions"
    - "Database migration 001_initial creates episodes, birds, topics, settings tables"
  artifacts:
    - path: "src-tauri/tauri.conf.json"
      provides: "Tauri app configuration with window, bundle, and plugin settings"
      contains: "Nettgefl"
    - path: "src-tauri/src/lib.rs"
      provides: "Rust app initialization with SQL plugin and migrations"
      contains: "tauri_plugin_sql"
    - path: "src-tauri/migrations/001_initial.sql"
      provides: "Initial database schema"
      contains: "CREATE TABLE"
    - path: "src-tauri/Entitlements.plist"
      provides: "macOS sandbox permissions"
      contains: "com.apple.security"
    - path: "src-tauri/capabilities/default.json"
      provides: "Tauri v2 plugin permissions"
      contains: "sql:default"
  key_links:
    - from: "src-tauri/src/lib.rs"
      to: "src-tauri/migrations/001_initial.sql"
      via: "include_str! macro loading migration SQL"
      pattern: "include_str!.*001_initial"
    - from: "src-tauri/tauri.conf.json"
      to: "src-tauri/Entitlements.plist"
      via: "macOS bundle entitlements reference"
      pattern: "entitlements"
---

<objective>
Scaffold the Tauri v2 desktop application with React frontend, configure macOS permissions/entitlements, and set up SQLite database with migration infrastructure.

Purpose: This is the foundation that ALL other Phase 1 plans depend on. Nothing can run without a working Tauri project with database and permissions.

Output: Compilable Tauri v2 app that launches on macOS, creates SQLite database on first run, and has correct entitlements for network/file access.
</objective>

<execution_context>
@/Users/tmtlxantonio/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tmtlxantonio/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-infrastructure/01-CONTEXT.md
@.planning/phases/01-foundation-infrastructure/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Tauri v2 project with React TypeScript template</name>
  <files>
    package.json
    tsconfig.json
    tsconfig.node.json
    vite.config.ts
    index.html
    src/main.tsx
    src/App.tsx
    src/styles.css
    src-tauri/Cargo.toml
    src-tauri/tauri.conf.json
    src-tauri/build.rs
    src-tauri/src/lib.rs
    src-tauri/src/main.rs
  </files>
  <action>
    Create a new Tauri v2 project using the React TypeScript template. Since we're in an existing git repo with existing files (backend/, frontend/, docs/), we need to initialize the Tauri structure alongside them.

    Steps:
    1. Run `npm create tauri-app@latest` in a temporary directory with these choices: React, TypeScript, npm. Then copy the generated files into the project root, being careful NOT to overwrite existing files (.git, .planning, backend, frontend, docs, etc.).

    Alternatively, initialize manually:
    1. Create `package.json` with Vite + React + TypeScript dependencies and Tauri CLI
    2. Create `vite.config.ts` with React plugin and Tauri-compatible settings
    3. Create `tsconfig.json` and `tsconfig.node.json` for TypeScript
    4. Create `index.html` as Vite entry point
    5. Create `src/main.tsx` as React entry point
    6. Create `src/App.tsx` as root component (minimal placeholder - real UI comes in Plan 02)
    7. Create `src/styles.css` with minimal base styles

    For Tauri backend:
    1. Create `src-tauri/` directory structure
    2. Create `src-tauri/Cargo.toml` with tauri v2, tauri-plugin-sql (with sqlite feature), tauri-build dependencies
    3. Create `src-tauri/build.rs` with standard tauri_build::build()
    4. Create `src-tauri/src/main.rs` with standard Tauri mobile entry point stub
    5. Create `src-tauri/src/lib.rs` with basic tauri::Builder setup (plugins added in next task)

    Configure `src-tauri/tauri.conf.json`:
    - `productName`: "Nettgefluster" (ASCII-safe for bundle ID)
    - `identifier`: "de.nettgefluester.app"
    - `version`: "0.1.0"
    - Window: title "Nettgefluster", width 1200, height 800, minWidth 800, minHeight 600, resizable true, decorations true
    - `theme`: null (auto-follow system)
    - `bundle.macOS.minimumSystemVersion`: "12.0"
    - `bundle.macOS.entitlements`: "./Entitlements.plist"

    After scaffolding, run `npm install` to verify dependencies resolve.

    IMPORTANT: Do NOT delete or modify existing directories (backend/, frontend/, docs/, .planning/, .git/). The Tauri project lives alongside them.
  </action>
  <verify>
    Run `npm install` completes without errors.
    Run `cd src-tauri && cargo check` completes without Rust compilation errors.
    Verify `src-tauri/tauri.conf.json` exists and contains correct window configuration.
  </verify>
  <done>
    Tauri v2 project structure exists alongside existing codebase. `npm install` and `cargo check` both succeed. tauri.conf.json has correct app name, window dimensions, and macOS minimum version.
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure macOS permissions, SQLite database with migrations, and Tauri capabilities</name>
  <files>
    src-tauri/Entitlements.plist
    src-tauri/Info.plist
    src-tauri/capabilities/default.json
    src-tauri/migrations/001_initial.sql
    src-tauri/src/lib.rs
    src-tauri/Cargo.toml
  </files>
  <action>
    1. Create `src-tauri/Entitlements.plist` with these permissions:
       - `com.apple.security.app-sandbox`: true
       - `com.apple.security.files.user-selected.read-only`: true
       - `com.apple.security.network.client`: true (needed for RSS feed fetching and auto-updater)
       NO microphone permission needed (transcribes existing episodes, not live recording).

    2. Create `src-tauri/Info.plist` with:
       - `CFBundleDisplayName`: "Nettgefluster"
       - `CFBundleName`: "Nettgefluster"

    3. Create `src-tauri/capabilities/default.json` with permissions:
       - "core:default"
       - "sql:default"
       - "sql:allow-execute"
       - "sql:allow-select"
       - "fs:default"
       These are required for Tauri v2 plugin security model. Without them, plugin commands fail with permission errors.

    4. Create `src-tauri/migrations/001_initial.sql`:
       ```sql
       CREATE TABLE IF NOT EXISTS episodes (
           id INTEGER PRIMARY KEY AUTOINCREMENT,
           episode_number INTEGER,
           title TEXT NOT NULL,
           publish_date TEXT,
           audio_url TEXT,
           duration_minutes REAL,
           transcription_text TEXT,
           transcribed INTEGER DEFAULT 0,
           speaker_a_time REAL,
           speaker_b_time REAL,
           created_at TEXT DEFAULT (datetime('now')),
           updated_at TEXT DEFAULT (datetime('now'))
       );

       CREATE TABLE IF NOT EXISTS birds (
           id INTEGER PRIMARY KEY AUTOINCREMENT,
           name TEXT NOT NULL,
           scientific_name TEXT,
           description TEXT,
           image_url TEXT,
           nabu_url TEXT,
           used INTEGER DEFAULT 0,
           used_date TEXT,
           created_at TEXT DEFAULT (datetime('now'))
       );

       CREATE TABLE IF NOT EXISTS topics (
           id INTEGER PRIMARY KEY AUTOINCREMENT,
           title TEXT NOT NULL,
           description TEXT,
           priority TEXT DEFAULT 'medium',
           status TEXT DEFAULT 'offen',
           category TEXT,
           episode_id INTEGER,
           created_at TEXT DEFAULT (datetime('now')),
           updated_at TEXT DEFAULT (datetime('now')),
           FOREIGN KEY (episode_id) REFERENCES episodes(id)
       );

       CREATE TABLE IF NOT EXISTS settings (
           key TEXT PRIMARY KEY,
           value TEXT NOT NULL,
           updated_at TEXT DEFAULT (datetime('now'))
       );

       CREATE TABLE IF NOT EXISTS episode_topics (
           id INTEGER PRIMARY KEY AUTOINCREMENT,
           episode_id INTEGER NOT NULL,
           topic_id INTEGER NOT NULL,
           planned INTEGER DEFAULT 0,
           discussed INTEGER DEFAULT 0,
           FOREIGN KEY (episode_id) REFERENCES episodes(id),
           FOREIGN KEY (topic_id) REFERENCES topics(id)
       );

       CREATE INDEX IF NOT EXISTS idx_episodes_publish_date ON episodes(publish_date);
       CREATE INDEX IF NOT EXISTS idx_topics_status ON topics(status);
       CREATE INDEX IF NOT EXISTS idx_birds_used ON birds(used);
       ```

    5. Update `src-tauri/Cargo.toml` to ensure tauri-plugin-sql with sqlite feature is included.

    6. Update `src-tauri/src/lib.rs` to initialize SQL plugin with migration:
       ```rust
       use tauri_plugin_sql::{Builder as SqlBuilder, Migration, MigrationKind};

       let migrations = vec![
           Migration {
               version: 1,
               description: "create_initial_tables",
               sql: include_str!("../migrations/001_initial.sql"),
               kind: MigrationKind::Up,
           },
       ];

       tauri::Builder::default()
           .plugin(
               SqlBuilder::default()
                   .add_migrations("sqlite:nettgefluester.db", migrations)
                   .build()
           )
           .run(tauri::generate_context!())
           .expect("error while running tauri application");
       ```

    7. Verify the full chain: Cargo.toml -> lib.rs -> migrations -> capabilities.
  </action>
  <verify>
    Run `cd src-tauri && cargo check` passes (Rust compilation with SQL plugin).
    Verify `src-tauri/capabilities/default.json` contains "sql:default" and "sql:allow-execute".
    Verify `src-tauri/Entitlements.plist` contains network.client and files.user-selected permissions.
    Verify `src-tauri/migrations/001_initial.sql` contains CREATE TABLE statements for all 5 tables.
    Run `npm run tauri dev` and confirm app window opens (may show blank page - that's OK for this plan).
  </verify>
  <done>
    macOS entitlements configured for sandbox with network + file access. SQLite database with 5 tables (episodes, birds, topics, settings, episode_topics) created via migration on first launch. Tauri capabilities grant SQL plugin permissions. App compiles and launches.
  </done>
</task>

</tasks>

<verification>
1. `npm install` completes without errors
2. `cd src-tauri && cargo check` passes
3. `npm run tauri dev` launches the app window on macOS
4. Database file is created in Tauri's AppData directory on first launch
5. All 5 tables exist in the SQLite database (can verify via sqlite3 CLI)
6. `src-tauri/capabilities/default.json` has sql and fs permissions
7. `src-tauri/Entitlements.plist` has network.client permission (no microphone)
</verification>

<success_criteria>
- Tauri v2 app compiles and launches on macOS
- SQLite database with 5 tables created via migration system
- macOS entitlements correctly configured (network, file access, no microphone)
- Tauri capabilities grant plugin permissions
- Existing codebase (backend/, frontend/, docs/) untouched
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-infrastructure/01-01-SUMMARY.md`
</output>
