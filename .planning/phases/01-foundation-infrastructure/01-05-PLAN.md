---
phase: 01-foundation-infrastructure
plan: 05
type: execute
wave: 3
depends_on: ["01-02", "01-03"]
files_modified:
  - src/components/Tutorial.tsx
  - src/components/pages/SettingsPage.tsx
  - src/components/UpdateBanner.tsx
  - src/locales/de/translation.json
  - src/App.tsx
  - src/lib/settings.ts
autonomous: true

must_haves:
  truths:
    - "First launch shows 2-3 screen tutorial introducing app features"
    - "Tutorial asks about launch-at-login preference"
    - "Tutorial only shows once (persisted in settings table)"
    - "Settings page shows app version, database status, and launch-at-login toggle"
    - "Update banner appears non-blocking when update is available"
    - "Post-update banner shows 'Jetzt auf vX.Y.Z' dismissible notification"
  artifacts:
    - path: "src/components/Tutorial.tsx"
      provides: "First-launch tutorial with 2-3 screens"
      min_lines: 60
    - path: "src/components/UpdateBanner.tsx"
      provides: "Non-blocking update notification banner"
      min_lines: 30
    - path: "src/lib/settings.ts"
      provides: "Settings read/write utility for SQLite"
      min_lines: 20
    - path: "src/components/pages/SettingsPage.tsx"
      provides: "Settings page with version, database, launch-at-login"
      min_lines: 40
  key_links:
    - from: "src/components/Tutorial.tsx"
      to: "src/lib/settings.ts"
      via: "reads/writes firstLaunchCompleted setting"
      pattern: "firstLaunchCompleted"
    - from: "src/App.tsx"
      to: "src/components/Tutorial.tsx"
      via: "conditionally renders tutorial on first launch"
      pattern: "Tutorial"
    - from: "src/components/UpdateBanner.tsx"
      to: "src/lib/updater.ts"
      via: "calls checkForUpdates and displays result"
      pattern: "checkForUpdates"
---

<objective>
Create the first-launch tutorial experience, wire up the Settings page with real data, and build the update notification banner UI.

Purpose: First impressions matter. The tutorial introduces hosts to the app. Settings gives them control. The update banner ensures seamless updates. Together these complete the user-facing Phase 1 experience.

Output: Working tutorial flow, functional settings page, and update notification system.
</objective>

<execution_context>
@/Users/tmtlxantonio/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tmtlxantonio/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-infrastructure/01-CONTEXT.md
@.planning/phases/01-foundation-infrastructure/01-RESEARCH.md
@.planning/phases/01-foundation-infrastructure/01-02-SUMMARY.md
@.planning/phases/01-foundation-infrastructure/01-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create settings utility and first-launch tutorial</name>
  <files>
    src/lib/settings.ts
    src/components/Tutorial.tsx
    src/locales/de/translation.json
    src/App.tsx
  </files>
  <action>
    1. Create `src/lib/settings.ts`:
       - Import Database from @tauri-apps/plugin-sql
       - `getSetting(key: string): Promise<string | null>` - reads from settings table
       - `setSetting(key: string, value: string): Promise<void>` - upserts into settings table (INSERT OR REPLACE)
       - `isFirstLaunch(): Promise<boolean>` - checks if "firstLaunchCompleted" setting exists
       - `markFirstLaunchComplete(): Promise<void>` - sets "firstLaunchCompleted" to "true"
       - Use `Database.load('sqlite:nettgefluester.db')` to get database handle
       - Handle errors gracefully (return defaults if database unavailable)

    2. Create `src/components/Tutorial.tsx`:
       In-app modal overlay tutorial with 2-3 screens. Uses `useTranslation()` for ALL text.

       Screen 1: "Willkommen bei Nettgefluster!"
       - Brief intro: "Diese App hilft euch, euren Podcast zu analysieren."
       - Show what's coming: Episoden, Sprechzeit-Analyse, Themen-Tracking, Vogel-Randomizer
       - "Weiter" button

       Screen 2: "Was euch erwartet"
       - Phase roadmap overview:
         Phase 1: App-Grundlage (aktuell)
         Phase 2: Episoden & Transkription
         Phase 3: Sprechzeit-Analyse
         Phase 4: Themen-Tracking
         Phase 5: Vogel-Randomizer
       - "Weiter" button

       Screen 3: "Einstellungen"
       - Toggle: "App beim Anmelden starten?" (launch at login)
       - "Los geht's!" button (closes tutorial)

       Implementation:
       - Modal overlay with semi-transparent backdrop
       - Card in center with content, progress dots, navigation buttons
       - Store current screen in React state
       - On "Los geht's!": call markFirstLaunchComplete(), save launch-at-login preference, close modal
       - Styled to match app theme (brand colors, light/dark mode support)
       - Keyboard support: Escape to skip, Enter to advance

    3. Add tutorial translations to `src/locales/de/translation.json`:
       ```json
       "tutorial": {
         "welcome_title": "Willkommen bei Nettgefluster!",
         "welcome_text": "Diese App hilft euch, euren Podcast zu analysieren und zu verbessern.",
         "features_title": "Was euch erwartet",
         "phase1": "App-Grundlage",
         "phase1_desc": "Die Basis steht - bereit fuer mehr!",
         "phase2": "Episoden & Transkription",
         "phase2_desc": "Automatische Transkription eurer Episoden",
         "phase3": "Sprechzeit-Analyse",
         "phase3_desc": "Wer spricht wie viel?",
         "phase4": "Themen-Tracking",
         "phase4_desc": "Offene Themen im Blick behalten",
         "phase5": "Vogel-Randomizer",
         "phase5_desc": "Zufaelliger Vogel der Woche",
         "settings_title": "Einstellungen",
         "launch_at_login": "App beim Anmelden starten?",
         "next": "Weiter",
         "start": "Los geht's!",
         "skip": "Ueberspringen",
         "current_phase": "aktuell"
       }
       ```

    4. Update `src/App.tsx`:
       - On mount, check `isFirstLaunch()`
       - If first launch, show Tutorial component as overlay on top of Layout
       - When tutorial closes, hide it and continue to main app
       - Also trigger `checkForUpdates()` on mount (non-blocking, in background)
  </action>
  <verify>
    Run `npx tsc --noEmit` passes.
    Verify `src/lib/settings.ts` has getSetting, setSetting, isFirstLaunch, markFirstLaunchComplete.
    Verify `src/components/Tutorial.tsx` renders 3 screens with German text from i18n.
    Verify `src/locales/de/translation.json` has tutorial section with all keys.
    Run `npm run tauri dev` and verify tutorial appears on first launch.
  </verify>
  <done>
    Settings utility reads/writes from SQLite settings table. Tutorial shows 3 screens on first launch with app intro, phase roadmap, and login preference. Tutorial text is entirely in German via i18n. Tutorial only shows once (persisted in database).
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire up Settings page and create update notification banner</name>
  <files>
    src/components/pages/SettingsPage.tsx
    src/components/UpdateBanner.tsx
    src/locales/de/translation.json
    src/App.tsx
  </files>
  <action>
    1. Update `src/components/pages/SettingsPage.tsx` with functional content:
       - App Information section:
         - App name: "Nettgefluster"
         - Version: read from `@tauri-apps/api/app` getVersion()
         - Database status: "Verbunden" (check connection) or "Fehler" with red indicator
       - Preferences section:
         - Launch at login toggle (read/write via settings utility)
       - About section:
         - Brief app description
         - Link to podcast website (opens in external browser via `@tauri-apps/plugin-shell`)
       - All text via `useTranslation()`
       - Style consistently with app theme
       - Use macOS-style toggle switches for boolean settings

    2. Create `src/components/UpdateBanner.tsx`:
       Non-blocking banner for update notifications. Two modes:

       Mode A: "Update verfuegbar"
       - Appears at top of content area (not a modal - non-blocking)
       - Shows version number and brief highlights
       - "Jetzt aktualisieren" button triggers download
       - "Spaeter erinnern" dismisses banner
       - Progress bar during download
       - After download: "Jetzt neu starten" or "Spaeter"

       Mode B: "Post-update" banner
       - Small dismissible banner: "Jetzt auf v{version}"
       - Shows on first launch after update
       - "X" button to dismiss
       - Auto-dismiss after 10 seconds

       Implementation:
       - Accept props: updateInfo (version, size, highlights), onDismiss, onUpdate
       - Styled as a slim banner at the top of the content area
       - Smooth slide-in animation
       - German text via i18n

    3. Add update banner translations to `src/locales/de/translation.json`:
       ```json
       "update": {
         "available": "Update verfuegbar: v{{version}}",
         "download": "Jetzt aktualisieren",
         "later": "Spaeter erinnern",
         "downloading": "Wird heruntergeladen... {{percent}}%",
         "ready": "Update bereit. Jetzt neu starten?",
         "restart": "Jetzt neu starten",
         "restart_later": "Spaeter",
         "post_update": "Jetzt auf v{{version}}",
         "size_warning": "Das Update ist {{size}} MB gross. Jetzt herunterladen?",
         "confirm": "Herunterladen",
         "cancel": "Abbrechen"
       }
       ```

    4. Update `src/App.tsx` to integrate UpdateBanner:
       - After checking for updates, if update available, show UpdateBanner
       - Pass update info and handler functions
       - Check for post-update state (version changed since last launch) and show post-update banner
       - Store last known version in settings for post-update detection

    Install shell plugin for opening external links:
    ```bash
    npm install @tauri-apps/plugin-shell
    ```
    Add "shell:default" to capabilities if needed.
  </action>
  <verify>
    Run `npx tsc --noEmit` passes.
    Run `npm run tauri dev` and verify:
    1. Settings page shows version number, database status
    2. Launch-at-login toggle exists and is interactive
    3. Update banner component renders (may not show if no update available - check console logs)
    Verify all new text is in German via translation file.
  </verify>
  <done>
    Settings page displays app version, database connection status, and launch-at-login toggle. Update banner provides non-blocking notification when updates are available, with download progress and restart prompt. Post-update banner shows version on first launch after update. All text in German via i18n.
  </done>
</task>

</tasks>

<verification>
1. First launch shows tutorial (3 screens in German)
2. Tutorial asks about launch-at-login and saves preference
3. Tutorial doesn't show on subsequent launches
4. Settings page shows real app version and database status
5. Update banner renders correctly (verify with mock data if no real update)
6. All new text is in German via translation system
7. TypeScript compilation passes
</verification>

<success_criteria>
- First-launch tutorial introduces app in 3 German-language screens
- Tutorial persists "completed" flag in SQLite settings table
- Settings page shows version, database status, launch-at-login toggle
- Update banner provides non-blocking notifications with progress
- Post-update banner shows version on first launch after update
- All UI text from i18n translation file
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-infrastructure/01-05-SUMMARY.md`
</output>
